---

- name: restart elasticsearch
  systemd: name=elasticsearch state=restarted enabled=yes daemon_reload=yes
  become: yes

- name: restart logstash
  systemd: name=logstash state=restarted enabled=yes daemon_reload=yes
  become: yes

- name: restart influxdb
  systemd: name=influxdb state=restarted enabled=yes daemon_reload=yes
  become: yes
  notify:
    - wait for influxdb to start
    - create default influxdb database

- name: wait for influxdb to start
  wait_for: port={{ influxdb_port }} timeout=60

- name: create default influxdb database
  influxdb_database: 
    hostname: localhost 
    database_name: "{{ influxdb_database_name }}"
    port: "{{ influxdb_port }}"
    state: present
  notify: alter default influxdb policy

- name: alter default influxdb policy
  influxdb_retention_policy:
    hostname: localhost
    database_name: "{{ influxdb_database_name }}"
    port: "{{ influxdb_port }}"
    policy_name: "{{ influxdb_database_name }}"
    duration: 52w
    replication: 1
    default: yes
