---

- name: Install python-pip
  apt: pkg=python-pip state=installed update_cache=false
  
- name: Install python-apscheduler
  pip: name=apscheduler state=present

- name: Upgrade setuptools
  pip: name=setuptools extra_args='--upgrade'
  
- name: Create openbach-agent repository
  file: path=/opt/openbach-agent state=directory mode=0755
  
- name: Create openbach-agent jobs repository
  file: path=/opt/openbach-agent/jobs state=directory mode=0755
  
- name: Install the daemon
  copy: src=openbach-agent/{{ item }} dest=/opt/openbach-agent/ mode=0644
  with_items:
    - openbach-agent.py
    - openbach-agent_filter.conf
  
- name: Install the openbach-baton script as an executable
  copy: src=openbach-agent/openbach-baton dest=/opt/openbach-agent/ mode=0755
  
- name: Create the service
  template: src=openbach-agent.j2 dest=/etc/init.d/openbach-agent mode=0755

- name: Start the service
  service: name=openbach-agent state=started

