---

- name: Install ntp and ntpdate
  apt: pkg={{ item }} state=installed update_cache=true
  with_items:
    - ntp
    - ntpdate
  when: inventory_hostname not in groups['Controller']

- name: Start Ntp server
  service: name=ntp state=started
  when: inventory_hostname not in groups['Controller']

- name: Delete all ntp source servers
  lineinfile: backup=yes dest=/etc/ntp.conf state=absent regexp=^server
  when: inventory_hostname not in groups['Controller']

- name: Add Controller as the ntp source server
  lineinfile: dest=/etc/ntp.conf state=present line={{ item }}
  with_items:
    - "\n# Controller ntp server"
    - "server {{ controller_ip }}"
  when: inventory_hostname not in groups['Controller']
  
- name: Restart Ntp server
  service: name=ntp state=restarted
  when: inventory_hostname not in groups['Controller']

