---

- name: Create openbach user
  user: name=openbach generate_ssh_key=yes ssh_key_bits=4096 shell=/bin/bash
  become: yes

- name: Trust the install SSH key by the openbach user
  authorized_key: user=openbach key={{ lookup('file', '{{ ansible_ssh_private_key_file }}.pub') }}
  become: yes

- name: Create openbach folder in /opt
  file: path=/opt/openbach owner=openbach group=openbach state=directory
  become: yes

- name: Update apt cache
  apt: update_cache=yes
  become: yes

- name: Install apt dependencies
  apt: pkg={{ item }} state=installed update_cache=no
  with_items:
    - ntp
    - ntpdate
    - python-pip
    - python3-pip
  become: yes
  notify: restart ntp

- name: Upgrade pip to the latests versions
  pip: name=pip executable={{ item }} extra_args='-U'
  with_items:
    - pip
    - pip3
  become: yes
