---

- hosts:
    - Controller
    - Collector
    - Agents
  remote_user: root

  tasks:
  - name: Install ntp and ntpdate
    apt: pkg={{ item }} state=installed update_cache=true
    with_items:
      - ntp
      - ntpdate

  - name: Start Ntp server
    service: name=ntp state=started
      
- hosts:
    - Collector
    - Agents
  remote_user: root
  
  tasks:
  - name: Delete all ntp source servers
    shell: sed -i 's/^server/#server/' /etc/ntp.conf

  - name: Add Controller as the ntp source server
    shell: echo "{{ item }}" >> /etc/ntp.conf
    with_items:
      - "\n# Controller ntp server"
      - "server {{ controller_ip }}"
    
  - name: Restart Ntp server
    service: name=ntp state=restarted
    
